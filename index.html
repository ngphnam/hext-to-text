<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Hex ↔ Text Converter</title>
    <style>
      :root {
        --bg: #0b1620;
        --panel: rgba(18, 30, 42, 0.9);
        --panel-border: #1f7bb5;
        --text: #e6f0ff;
        --muted: #9bb1c7;
        --accent: #31a7ff;
        --accent-2: #58d1ff;
        --danger: #ff6b6b;
        --shadow: 0 18px 40px rgba(0, 0, 0, 0.35);
      }

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        color: var(--text);
        background: radial-gradient(circle at top, #1b2f42, #0b1620 60%);
        min-height: 100vh;
        display: grid;
        place-items: center;
        padding: 32px 16px;
      }

      .app {
        width: min(980px, 100%);
      }

      .header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 12px;
        padding: 14px 18px;
        background: rgba(16, 26, 38, 0.9);
        border: 1px solid rgba(49, 167, 255, 0.45);
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 1.5px;
        font-weight: 600;
        box-shadow: var(--shadow);
      }

      .header .title {
        font-size: 16px;
      }

      .header .gear {
        width: 18px;
        height: 18px;
        border-radius: 4px;
        border: 2px solid var(--accent);
        position: relative;
      }

      .header .gear::after {
        content: "";
        position: absolute;
        inset: 4px;
        border-radius: 50%;
        border: 2px solid var(--accent-2);
      }

      .header .admin-link {
        color: var(--accent-2);
        text-decoration: none;
        font-size: 12px;
      }

      .header .admin-link:hover {
        text-decoration: underline;
      }

      .header .admin-link {
        color: var(--accent-2);
        text-decoration: none;
        font-size: 12px;
      }

      .header .admin-link:hover {
        text-decoration: underline;
      }

      .grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 20px;
        margin-top: 22px;
      }

      .panel {
        background: var(--panel);
        border: 1px solid rgba(49, 167, 255, 0.6);
        border-radius: 14px;
        padding: 18px;
        min-height: 360px;
        box-shadow: var(--shadow);
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .panel h2 {
        margin: 0;
        font-size: 15px;
        color: var(--accent-2);
        text-transform: uppercase;
        letter-spacing: 1px;
      }

      textarea {
        flex: 1;
        resize: vertical;
        min-height: 180px;
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.1);
        background: rgba(8, 16, 24, 0.9);
        color: var(--text);
        padding: 12px;
        font-size: 14px;
        line-height: 1.4;
      }

      textarea::placeholder {
        color: rgba(155, 177, 199, 0.6);
      }

      .actions {
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
      }

      button {
        border: none;
        padding: 10px 14px;
        border-radius: 8px;
        font-weight: 600;
        cursor: pointer;
        color: #02131f;
        background: linear-gradient(135deg, #2ca4ff, #6fd8ff);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }

      button:hover {
        transform: translateY(-1px);
        box-shadow: 0 8px 18px rgba(34, 154, 255, 0.35);
      }

      button.secondary {
        background: rgba(29, 46, 62, 0.85);
        color: var(--text);
        border: 1px solid rgba(88, 209, 255, 0.4);
      }

      .hint {
        font-size: 12px;
        color: var(--muted);
      }

      .status {
        font-size: 12px;
        color: var(--muted);
      }

      .status.error {
        color: var(--danger);
      }

      .status.success {
        color: #78ffa3;
      }

      .hidden {
        display: none !important;
      }

      .admin-view {
        margin-top: 22px;
      }

      .admin-list {
        display: grid;
        gap: 10px;
        max-height: 220px;
        overflow: auto;
        padding-right: 4px;
      }

      .admin-item {
        border: 1px solid rgba(88, 209, 255, 0.35);
        border-radius: 10px;
        padding: 10px 12px;
        background: rgba(8, 16, 24, 0.85);
      }

      .admin-item .meta {
        font-size: 11px;
        color: var(--muted);
        margin-bottom: 6px;
      }

      .admin-item .hex {
        font-family: "Segoe UI", system-ui, -apple-system, sans-serif;
        font-size: 13px;
        color: var(--accent-2);
        margin-bottom: 4px;
        word-break: break-all;
      }

      .admin-item .text {
        font-size: 13px;
        word-break: break-word;
      }

      .admin-item .actions {
        margin-top: 8px;
      }
    </style>
  </head>
  <body>
    <div class="app" id="appView">
      <div class="header">
        <div class="title">Hex to Text Converter</div>
        <a class="admin-link" href="#/admin">/admin</a>
        <div class="gear" aria-hidden="true"></div>
      </div>

      <div class="grid">
        <section class="panel">
          <h2>Hexadecimal Input</h2>
          <textarea
            id="hexInput"
            placeholder="Ví dụ: 48 65 6c 6c 6f 2c 20 57 6f 72 6c 64 21"
          ></textarea>
          <div class="actions">
            <button id="hexToTextBtn">Convert to Text</button>
            <button id="copyHexBtn" class="secondary">Copy Hex</button>
            <button id="pasteHexBtn" class="secondary">Paste</button>
          </div>
          <div class="hint">
            Khoảng trắng sẽ tự xoá. Có thể dán có/không khoảng trắng.
          </div>
        </section>

        <section class="panel">
          <h2>Text Output</h2>
          <textarea
            id="textOutput"
            placeholder="Kết quả sẽ hiển thị ở đây"
          ></textarea>
          <div class="actions">
            <button id="textToHexBtn">Convert to Hex</button>
            <button id="copyTextBtn" class="secondary">Copy Text</button>
            <button id="clearBtn" class="secondary">Clear</button>
          </div>
          <div id="status" class="status">Sẵn sàng.</div>
        </section>
      </div>
    </div>

    <section class="panel admin-view hidden" id="adminView">
      <h2>Admin / Decodes</h2>
      <div id="adminList" class="admin-list"></div>
      <textarea id="adminJson" readonly></textarea>
      <div class="actions">
        <button id="copyAdminJsonBtn">Copy JSON</button>
        <button id="downloadAdminJsonBtn" class="secondary">Download JSON</button>
        <button id="clearAllBtn" class="secondary">Xoá tất cả</button>
          <button id="backToAppBtn" class="secondary">Quay lại</button>
      </div>
      <div id="adminStatus" class="status">Sẵn sàng.</div>
    </section>

    <script>
      const hexInput = document.getElementById("hexInput");
      const textOutput = document.getElementById("textOutput");
      const statusEl = document.getElementById("status");
      const hexToTextBtn = document.getElementById("hexToTextBtn");
      const textToHexBtn = document.getElementById("textToHexBtn");
      const copyHexBtn = document.getElementById("copyHexBtn");
      const copyTextBtn = document.getElementById("copyTextBtn");
      const pasteHexBtn = document.getElementById("pasteHexBtn");
      const clearBtn = document.getElementById("clearBtn");
      const appView = document.getElementById("appView");
      const adminView = document.getElementById("adminView");
      const adminJson = document.getElementById("adminJson");
      const adminList = document.getElementById("adminList");
      const copyAdminJsonBtn = document.getElementById("copyAdminJsonBtn");
      const downloadAdminJsonBtn = document.getElementById(
        "downloadAdminJsonBtn"
      );
      const adminStatusEl = document.getElementById("adminStatus");
      const clearAllBtn = document.getElementById("clearAllBtn");
      const backToAppBtn = document.getElementById("backToAppBtn");

      const STORAGE_KEY = "hexToText.decodes";
      const DEFAULT_JSON_URL = "decodes.json";

      const setStatus = (message, type = "") => {
        statusEl.textContent = message;
        statusEl.className = `status${type ? " " + type : ""}`;
      };

      const setAdminStatus = (message, type = "") => {
        adminStatusEl.textContent = message;
        adminStatusEl.className = `status${type ? " " + type : ""}`;
      };

      const clearCurrentResult = () => {
        textOutput.value = "";
        setStatus("Sẵn sàng.");
      };

      const normalizeHex = (input) =>
        input.replace(/0x/gi, "").replace(/[^0-9a-fA-F]/g, "");

      const formatHexPairs = (hex) => {
        const pairs = hex.match(/.{1,2}/g);
        return pairs ? pairs.join(" ") : "";
      };

      const getDecodes = () => {
        try {
          const raw = sessionStorage.getItem(STORAGE_KEY);
          const parsed = raw ? JSON.parse(raw) : [];
          return Array.isArray(parsed) ? parsed : [];
        } catch (err) {
          return [];
        }
      };

      const saveDecodes = (list) => {
        sessionStorage.setItem(STORAGE_KEY, JSON.stringify(list));
      };

      const addDecode = (entry) => {
        const list = getDecodes();
        list.push(entry);
        saveDecodes(list);
        return list;
      };

      const hexToText = (hexString) => {
        const cleaned = normalizeHex(hexString);
        if (!cleaned) {
          return "";
        }
        if (cleaned.length % 2 !== 0) {
          throw new Error("Số ký tự hex phải là số chẵn.");
        }
        const bytes = cleaned.match(/.{2}/g) || [];
        const chars = bytes.map((byte) => {
          const code = parseInt(byte, 16);
          if (Number.isNaN(code)) {
            throw new Error(`Giá trị hex không hợp lệ: ${byte}`);
          }
          return String.fromCharCode(code);
        });
        return chars.join("");
      };

      const textToHex = (text) => {
        if (!text) {
          return "";
        }
        const bytes = Array.from(text).map((char) =>
          char.charCodeAt(0).toString(16).padStart(2, "0")
        );
        return bytes.join(" ");
      };

      const copyToClipboard = async (value, label) => {
        if (!value) {
          setStatus(`Không có dữ liệu để copy (${label}).`, "error");
          return;
        }
        try {
          await navigator.clipboard.writeText(value);
          setStatus(`Đã copy ${label} vào clipboard.`, "success");
        } catch (err) {
          setStatus(`Copy thất bại (${label}).`, "error");
        }
      };

      const renderAdminJson = () => {
        const list = getDecodes();
        adminJson.value = JSON.stringify(list, null, 2);
      };

      const renderAdminList = () => {
        const list = getDecodes();
        adminList.innerHTML = "";
        if (!list.length) {
          adminList.innerHTML =
            '<div class="status">Chưa có dữ liệu.</div>';
          return;
        }
        list.forEach((item, index) => {
          const row = document.createElement("div");
          row.className = "admin-item";
          row.innerHTML = `
            <div class="meta">${item.createdAt || ""}</div>
            <div class="hex">${item.hex || ""}</div>
            <div class="text">${item.text || ""}</div>
            <div class="actions">
              <button class="secondary" data-delete-index="${index}">
                Xoá mục này
              </button>
            </div>
          `;
          adminList.appendChild(row);
        });
      };

      const syncAdminView = () => {
        renderAdminList();
        renderAdminJson();
      };

      const isAdminPath = () => {
        if (window.location.hash === "#/admin") {
          return true;
        }
        if (window.location.search.includes("admin=1")) {
          return true;
        }
        return window.location.pathname.replace(/\/+$/, "") === "/admin";
      };

      const showAdmin = () => {
        appView.classList.add("hidden");
        adminView.classList.remove("hidden");
        syncAdminView();
      };

      const showApp = () => {
        adminView.classList.add("hidden");
        appView.classList.remove("hidden");
      };

      if (isAdminPath()) {
        showAdmin();
      }

      hexInput.addEventListener("input", () => {
        const raw = hexInput.value;
        const cleaned = normalizeHex(raw);
        if (raw !== cleaned) {
          hexInput.value = cleaned;
          const end = cleaned.length;
          hexInput.setSelectionRange(end, end);
        }
      });

      hexInput.addEventListener("paste", () => {
        clearCurrentResult();
      });

      hexToTextBtn.addEventListener("click", () => {
        try {
          const raw = hexInput.value;
          const cleaned = normalizeHex(raw);
          if (!cleaned) {
            if (raw.trim()) {
              setStatus("Dữ liệu không hợp lệ.", "error");
            } else {
              setStatus("Không có dữ liệu để convert.", "error");
            }
            return;
          }
          const result = hexToText(cleaned);
          textOutput.value = result;
          const formattedHex = formatHexPairs(cleaned.toUpperCase());
          if (result) {
            addDecode({
              createdAt: new Date().toISOString(),
              hex: formattedHex,
              text: result,
            });
          }
          if (!adminView.classList.contains("hidden")) {
            syncAdminView();
          }
          setStatus("Đã chuyển Hex → Text.", "success");
        } catch (err) {
          setStatus(err.message, "error");
        }
      });

      textToHexBtn.addEventListener("click", () => {
        const result = textToHex(textOutput.value);
        hexInput.value = result;
        setStatus("Đã chuyển Text → Hex.", "success");
      });

      copyHexBtn.addEventListener("click", () => {
        copyToClipboard(hexInput.value, "Hex");
      });

      pasteHexBtn.addEventListener("click", async () => {
        try {
          const text = await navigator.clipboard.readText();
          if (!text) {
            setStatus("Clipboard trống.", "error");
            return;
          }
          hexInput.value = text;
          hexInput.dispatchEvent(new Event("input"));
          clearCurrentResult();
        } catch (err) {
          setStatus("Không thể dán từ clipboard.", "error");
        }
      });

      copyTextBtn.addEventListener("click", () => {
        copyToClipboard(textOutput.value, "Text");
      });

      clearBtn.addEventListener("click", () => {
        hexInput.value = "";
        textOutput.value = "";
        setStatus("Đã xoá dữ liệu.", "success");
      });

      copyAdminJsonBtn.addEventListener("click", async () => {
        try {
          await navigator.clipboard.writeText(adminJson.value);
          setAdminStatus("Đã copy JSON.", "success");
        } catch (err) {
          setAdminStatus("Copy JSON thất bại.", "error");
        }
      });

      downloadAdminJsonBtn.addEventListener("click", () => {
        const blob = new Blob([adminJson.value], {
          type: "application/json;charset=utf-8",
        });
        const url = URL.createObjectURL(blob);
        const link = document.createElement("a");
        link.href = url;
        link.download = "decodes.json";
        document.body.appendChild(link);
        link.click();
        link.remove();
        URL.revokeObjectURL(url);
        setAdminStatus("Đã tải file JSON.", "success");
      });

      adminList.addEventListener("click", (event) => {
        const target = event.target;
        if (!(target instanceof HTMLElement)) {
          return;
        }
        const index = target.getAttribute("data-delete-index");
        if (index === null) {
          return;
        }
        const list = getDecodes();
        const idx = Number(index);
        if (Number.isNaN(idx) || idx < 0 || idx >= list.length) {
          return;
        }
        list.splice(idx, 1);
        saveDecodes(list);
        syncAdminView();
        setAdminStatus("Đã xoá mục.", "success");
      });

      clearAllBtn.addEventListener("click", () => {
        saveDecodes([]);
        syncAdminView();
        setAdminStatus("Đã xoá tất cả.", "success");
      });

      backToAppBtn.addEventListener("click", () => {
        if (window.location.hash === "#/admin") {
          window.location.hash = "";
          showApp();
          return;
        }
        window.location.href = "/";
      });

      window.addEventListener("hashchange", () => {
        if (window.location.hash === "#/admin") {
          showAdmin();
        } else {
          showApp();
        }
      });
    </script>
  </body>
</html>
